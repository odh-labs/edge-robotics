digraph {

    # Default styling for the whole diagram
    graph [fontname = "helvetica"];
    edge  [fontname = "helvetica"];
    node  [
        fontname = "helvetica"
        labelloc=t;
        fontsize=30;
        shape=record;
        style=filled;
    ];

    graph [label="Red Hat OpenShift Data Science - Edge Demo Workflow", labelloc=t; fontsize=30; ]; {

        subgraph {
            model [
                label = <{<b>1 - Build model</b>
                | a) RHODS Notebook builds model with pytorch.   |
                b) RHODS Notebook saves model pytorch pt file.|
                c) RHODS Notebook pushes pytorch pt file to git. }>
            ];
        }

        subgraph  {
            container [
                label = <{<b>2 - Containerise model on hub cluster</b>
                | a) Tekton build pipeline manually triggered.       |
                b) Tekton Task clones codebase into workspace.|
                c) Tekton Task builds container image locally       |
                d) Tekton Task pushes image to quay.                 }>
            ];
        }

        subgraph  {
            gitops [
                label = <{<b>3 - Onboard edge device cluster</b>
                | a) Tekton cluster add pipeline manually triggered .|
                 b) Remote edge cluster added to hub gitops.         }>
            ];
        }

        subgraph  {
            push [
                label = <{<b>4b - Push and run model at edge</b>
                | a) Openshift gitops syncs model deployment to edge.|
                b) Edge device cluster pulls new model image.           |
                c) New container starts up and becomes healthy.        |
                d) Model is serving via openshift route.                       }>
            ];
        }

        # Link the subgraphs together
        model -> container
        container -> gitops
        gitops -> push
    }
}
